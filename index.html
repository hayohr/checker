<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Username Checker</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'mc-green': '#3E8941',
                        'mc-dark': '#1F1F1F',
                        'mc-light': '#EFEFEF',
                        'mc-red': '#C43030',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar styling for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #3E8941;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-track {
            background-color: #1F1F1F;
        }
    </style>
</head>
<body class="bg-mc-dark min-h-screen flex items-center justify-center p-4 font-sans">
    <div class="w-full max-w-lg bg-mc-light rounded-2xl shadow-2xl p-6 md:p-8">
        <h1 class="text-3xl font-extrabold text-mc-dark mb-2 flex items-center">
            <svg class="w-8 h-8 mr-2 text-mc-green" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" />
            </svg>
            MC Name Checker
        </h1>
        <p class="text-gray-600 mb-6">Check the availability of a Minecraft Java Edition username.</p>

        <!-- Input and Button -->
        <div class="flex flex-col sm:flex-row gap-4 mb-6">
            <input
                type="text"
                id="usernameInput"
                placeholder="Enter Username (e.g., steve)"
                minlength="3"
                maxlength="16"
                class="flex-grow p-3 rounded-xl border-2 border-gray-300 focus:border-mc-green focus:ring-mc-green transition duration-200 shadow-inner text-mc-dark"
            />
            <button
                id="checkButton"
                onclick="checkUsernameAvailability()"
                class="bg-mc-green text-white font-bold py-3 px-6 rounded-xl hover:bg-opacity-90 active:scale-[0.98] transition duration-150 shadow-md hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-mc-green focus:ring-opacity-50"
            >
                Check
            </button>
        </div>

        <!-- Result Container -->
        <div id="resultContainer" class="min-h-[100px] border border-gray-300 bg-white rounded-xl p-4 shadow-inner flex flex-col justify-center transition-all duration-300">
            <p id="resultText" class="text-gray-500 italic text-center">
                Enter a name above to check its status.
            </p>
            <p id="statusHint" class="text-xs mt-2 text-center text-gray-400">
                Status is based on the official Mojang/Microsoft API.
            </p>
        </div>
    </div>

    <script>
        // --- START OF CRITICAL FIX ---

        // The original API endpoint we want to hit
        const MOJANG_API_BASE = "https://api.mojang.com/users/profiles/minecraft/";
        
        // FIX: Using the allorigins proxy which is generally more reliable for GitHub Pages
        const CORS_PROXY = "https://api.allorigins.win/raw?url=";

        // --- END OF CRITICAL FIX ---


        const resultContainer = document.getElementById('resultContainer');
        const resultText = document.getElementById('resultText');
        const usernameInput = document.getElementById('usernameInput');
        const checkButton = document.getElementById('checkButton');

        /**
         * Utility function for exponential backoff retry logic.
         */
        const fetchWithRetry = async (url, options = {}, retries = 3) => {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    // Check for rate limiting (429) or other retry-worthy errors
                    if (response.status === 429 && i < retries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 500;
                        console.warn(`Rate limit hit (429). Retrying in ${delay / 1000}s...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    return response;
                } catch (error) {
                    console.error("Fetch error:", error);
                    if (i < retries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 500;
                        console.warn(`Fetch failed. Retrying in ${delay / 1000}s...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    throw error;
                }
            }
            throw new Error("Failed to fetch after multiple retries.");
        };


        async function checkUsernameAvailability() {
            const username = usernameInput.value.trim();

            // 1. Basic Validation
            if (username.length < 3 || username.length > 16 || !/^[a-zA-Z0-9_]+$/.test(username)) {
                updateResult('Invalid username: Must be 3-16 alphanumeric characters (A-z, 0-9) or underscores.', 'text-mc-red font-semibold', 'border-mc-red');
                return;
            }

            // Construct the full URL: Proxy URL + Mojang URL (encoded)
            // THIS IS THE LINE THAT NOW USES THE PROXY!
            const mojangUrl = MOJANG_API_BASE + username;
            const fullApiUrl = CORS_PROXY + encodeURIComponent(mojangUrl);


            // 2. UI preparation for loading state
            resultText.innerHTML = '<span class="animate-pulse">Checking availability...</span>';
            resultContainer.classList.remove('border-mc-green', 'border-mc-red');
            resultContainer.classList.add('border-gray-500');
            checkButton.disabled = true;
            checkButton.textContent = 'Checking...';

            try {
                // 3. API Call
                const response = await fetchWithRetry(fullApiUrl);

                // 4. Handle Responses
                if (response.status === 200) {
                    // Status 200 means a profile was found, so the name is TAKEN.
                    updateResult(
                        `'${username}' is **TAKEN**!`,
                        'text-mc-red font-bold text-xl',
                        'border-mc-red'
                    );
                } else if (response.status === 204) {
                    // Status 204 (No Content) means no profile was found, so the name is AVAILABLE.
                    updateResult(
                        `ðŸŽ‰ '${username}' is **AVAILABLE!**`,
                        'text-mc-green font-bold text-xl',
                        'border-mc-green'
                    );
                } else if (response.status === 400) {
                    // Status 400 (Bad Request) could be for invalid format not caught by client-side validation
                     updateResult(
                        'Bad Request. The API did not accept the username format.',
                        'text-mc-red font-semibold',
                        'border-mc-red'
                    );
                } else if (response.status === 429) {
                    // Status 429 (Too Many Requests - Rate Limit)
                    updateResult(
                        'Rate Limit Exceeded. Mojang is currently limiting requests. Please wait 1-2 minutes and try again.',
                        'text-yellow-600 font-semibold',
                        'border-yellow-600'
                    );
                }
                else {
                    // General unexpected error
                    updateResult(
                        `Error: Could not check status (Status Code: ${response.status}). Try again later.`,
                        'text-mc-red font-semibold',
                        'border-mc-red'
                    );
                }

            } catch (error) {
                console.error("Critical error during username check:", error);
                updateResult(
                    'Network Error. Failed to reach the proxy service or Mojang API.',
                    'text-mc-red font-semibold',
                    'border-mc-red'
                );
            } finally {
                // 5. Restore UI state
                checkButton.disabled = false;
                checkButton.textContent = 'Check';
            }
        }

        /**
         * Updates the result box with the appropriate message and styling.
         * @param {string} message - The HTML message to display.
         * @param {string} textClass - Tailwind class for text color/weight.
         * @param {string} borderClass - Tailwind class for border color.
         */
        function updateResult(message, textClass, borderClass) {
            // Use innerHTML and a regex replacement to allow bold formatting via markdown
            const htmlMessage = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            resultText.innerHTML = htmlMessage;
            resultText.className = `text-center ${textClass}`;

            resultContainer.classList.remove('border-gray-500', 'border-mc-green', 'border-mc-red', 'border-yellow-600');
            resultContainer.classList.add(borderClass);

            document.getElementById('statusHint').classList.remove('hidden');
        }

        // Allow pressing Enter in the input field to trigger the check
        usernameInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                checkUsernameAvailability();
            }
        });

    </script>
</body>
</html>
